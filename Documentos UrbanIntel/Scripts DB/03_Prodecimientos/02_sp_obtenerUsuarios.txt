DELIMITER $$

CREATE PROCEDURE sp_obtenerUsuarios(
    IN p_rut VARCHAR(20)
)
BEGIN
    IF p_rut IS NULL OR p_rut = '' THEN
        SELECT u.Id, u.Rut, u.Nombre, u.Apellido, u.Email, u.Telefono, u.Direccion, r.nombre AS Rol
        FROM usuario u
        LEFT JOIN RolUsuario ru ON u.Rut = ru.rut
        LEFT JOIN Rol r ON ru.id_rol = r.id_rol;
    ELSE
        SELECT u.Id, u.Rut, u.Nombre, u.Apellido, u.Email, u.Telefono, u.Direccion, r.nombre AS Rol
        FROM Usuario u
        LEFT JOIN RolUsuario ru ON u.Rut = ru.rut
        LEFT JOIN Rol r ON ru.id_rol = r.id_rol
        WHERE u.Rut = p_rut;
    END IF;
END$$

DELIMITER ;